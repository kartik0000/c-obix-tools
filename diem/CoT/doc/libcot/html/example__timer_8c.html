<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>libcot: example_timer.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>example_timer.c File Reference</h1><code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;pthread.h&gt;</code><br>
<code>#include &lt;ptask.h&gt;</code><br>
<code>#include &lt;<a class="el" href="obix__client_8h-source.html">obix_client.h</a>&gt;</code><br>

<p>
<a href="example__timer_8c-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="example__timer_8c.html#404414e6ec2b2d9ed18f9cadb25ea09f">CONNECTION_ID</a>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="example__timer_8c.html#7b65e3051fe5ca35550e8d7760173953">resetListener</a> (int connectionId, int deviceId, int listenerId, const char *newValue)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="example__timer_8c.html#398c08e8e037f8a35334e2b7d2093312">generateTimeString</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="example__timer_8c.html#7d24e3eaa1f6ebfa87bd58a2ac9a254d">timerTask</a> (void *arg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="bf469fd82511b065b75ddb85f4d38066"></a><!-- doxytag: member="example_timer.c::getDeviceData" ref="bf469fd82511b065b75ddb85f4d38066" args="(char *deviceUri)" -->
char *&nbsp;</td><td class="memItemRight" valign="bottom"><b>getDeviceData</b> (char *deviceUri)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="example__timer_8c.html#3c04138a5bfe5d72780bb7e82a18e627">main</a> (int argc, char **argv)</td></tr>

<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="example__timer_8c.html#9c4545e53444d246701d1051c17cf6f8">DEVICE_DATA</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">unsigned long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="example__timer_8c.html#d34745f2e7e68a9694ec9a12c648bd75">_time</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="example__timer_8c.html#ef8634b59ae35cce508a6ce03b4d0564">_time_str</a> [32]</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">pthread_mutex_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="example__timer_8c.html#a3666ba0befbc998cc4bc96d3d3ed96d">_time_mutex</a> = PTHREAD_MUTEX_INITIALIZER</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">Task_Thread *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="example__timer_8c.html#8c0ec52cbb654e552557839aca0317a8">taskThread</a></td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
This is simple oBIX Timer device implementation, which demonstrates usage of oBIX client library. It shows the time elapsed after timer was started or reset by user. Device registers itself at oBIX Server, regularly updates elapsed time on it and listens to updates of "reset" parameter. If someone changes "reset" to true, that elapsed time is set to 0.<p>
<dl class="author" compact><dt><b>Author:</b></dt><dd>Andrey Litvinov </dd></dl>
<dl class="version" compact><dt><b>Version:</b></dt><dd>1.0 </dd></dl>

<p>Definition in file <a class="el" href="example__timer_8c-source.html">example_timer.c</a>.</p>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="404414e6ec2b2d9ed18f9cadb25ea09f"></a><!-- doxytag: member="example_timer.c::CONNECTION_ID" ref="404414e6ec2b2d9ed18f9cadb25ea09f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CONNECTION_ID&nbsp;&nbsp;&nbsp;0          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
ID of the connection which is described in configuration file. 
<p>Definition at line <a class="el" href="example__timer_8c-source.html#l00021">21</a> of file <a class="el" href="example__timer_8c-source.html">example_timer.c</a>.</p>

<p>Referenced by <a class="el" href="example__timer_8c-source.html#l00149">main()</a>, and <a class="el" href="example__timer_8c-source.html#l00113">timerTask()</a>.</p>

</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="398c08e8e037f8a35334e2b7d2093312"></a><!-- doxytag: member="example_timer.c::generateTimeString" ref="398c08e8e037f8a35334e2b7d2093312" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void generateTimeString           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Generates string representation of elapsed time according to <em>xs:duration</em> XML data type. 
<p>Definition at line <a class="el" href="example__timer_8c-source.html#l00083">83</a> of file <a class="el" href="example__timer_8c-source.html">example_timer.c</a>.</p>

<p>References <a class="el" href="example__timer_8c-source.html#l00030">_time</a>, and <a class="el" href="example__timer_8c-source.html#l00032">_time_str</a>.</p>

<p>Referenced by <a class="el" href="example__timer_8c-source.html#l00113">timerTask()</a>.</p>

</div>
</div><p>
<a class="anchor" name="3c04138a5bfe5d72780bb7e82a18e627"></a><!-- doxytag: member="example_timer.c::main" ref="3c04138a5bfe5d72780bb7e82a18e627" args="(int argc, char **argv)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>argv</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Entry point of the Timer application. It takes the name of the configuration file (use <em>example_timer_config.xml</em>).<p>
<dl class="see" compact><dt><b>See also:</b></dt><dd>example_timer_config.xml </dd></dl>

<p>Definition at line <a class="el" href="example__timer_8c-source.html#l00149">149</a> of file <a class="el" href="example__timer_8c-source.html">example_timer.c</a>.</p>

<p>References <a class="el" href="example__timer_8c-source.html#l00021">CONNECTION_ID</a>, <a class="el" href="obix__client_8c-source.html#l00704">obix_dispose()</a>, <a class="el" href="obix__client_8c-source.html#l00407">obix_loadConfigFile()</a>, <a class="el" href="obix__client_8c-source.html#l00489">obix_openConnection()</a>, <a class="el" href="obix__client_8c-source.html#l00550">obix_registerDevice()</a>, <a class="el" href="obix__client_8c-source.html#l00601">obix_registerListener()</a>, <a class="el" href="obix__client_8h-source.html#l00058">OBIX_SUCCESS</a>, <a class="el" href="example__timer_8c-source.html#l00050">resetListener()</a>, <a class="el" href="example__timer_8c-source.html#l00039">taskThread</a>, and <a class="el" href="example__timer_8c-source.html#l00113">timerTask()</a>.</p>

</div>
</div><p>
<a class="anchor" name="7b65e3051fe5ca35550e8d7760173953"></a><!-- doxytag: member="example_timer.c::resetListener" ref="7b65e3051fe5ca35550e8d7760173953" args="(int connectionId, int deviceId, int listenerId, const char *newValue)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int resetListener           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>connectionId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>deviceId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>listenerId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>newValue</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Handles changes of <em>"reset"</em> value. The function implements <a class="el" href="obix__client_8h.html#0197aa45d0471b2708a5bd01c30d7786">obix_update_listener()</a> prototype and is registered as a listener of <em>"reset"</em> param using <a class="el" href="obix__client_8c.html#6d554298664e9ad93b62e83d1606d02e">obix_registerListener()</a>. If <em>"reset"</em> value is changed at oBIX server to <em>"true"</em> it will set it back to "false" and reset timer.<p>
<dl class="see" compact><dt><b>See also:</b></dt><dd><a class="el" href="obix__client_8h.html#0197aa45d0471b2708a5bd01c30d7786">obix_update_listener()</a>, <a class="el" href="obix__client_8c.html#6d554298664e9ad93b62e83d1606d02e">obix_registerListener()</a>. </dd></dl>

<p>Definition at line <a class="el" href="example__timer_8c-source.html#l00050">50</a> of file <a class="el" href="example__timer_8c-source.html">example_timer.c</a>.</p>

<p>References <a class="el" href="example__timer_8c-source.html#l00030">_time</a>, <a class="el" href="example__timer_8c-source.html#l00037">_time_mutex</a>, <a class="el" href="obix__client_8h-source.html#l00058">OBIX_SUCCESS</a>, and <a class="el" href="obix__client_8c-source.html#l00676">obix_writeValue()</a>.</p>

<p>Referenced by <a class="el" href="example__timer_8c-source.html#l00149">main()</a>.</p>

</div>
</div><p>
<a class="anchor" name="7d24e3eaa1f6ebfa87bd58a2ac9a254d"></a><!-- doxytag: member="example_timer.c::timerTask" ref="7d24e3eaa1f6ebfa87bd58a2ac9a254d" args="(void *arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void timerTask           </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>arg</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Updates timer value and writes it to oBIX server. Implements periodic_task() prototype and is scheduled using ptask_schedule(). This method is executed in a separate thread that is why it uses <a class="el" href="example__timer_8c.html#a3666ba0befbc998cc4bc96d3d3ed96d">_time_mutex</a> for synchronization with <a class="el" href="example__timer_8c.html#7b65e3051fe5ca35550e8d7760173953">resetListener()</a> which sets timer to 0.<p>
<dl class="see" compact><dt><b>See also:</b></dt><dd>periodic_task(), ptask_schedule(). </dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>arg</em>&nbsp;</td><td>Assumes that a pointer to the device ID is passed here. Device ID is used for updating time value at the server. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="example__timer_8c-source.html#l00113">113</a> of file <a class="el" href="example__timer_8c-source.html">example_timer.c</a>.</p>

<p>References <a class="el" href="example__timer_8c-source.html#l00030">_time</a>, <a class="el" href="example__timer_8c-source.html#l00037">_time_mutex</a>, <a class="el" href="example__timer_8c-source.html#l00032">_time_str</a>, <a class="el" href="example__timer_8c-source.html#l00021">CONNECTION_ID</a>, <a class="el" href="example__timer_8c-source.html#l00083">generateTimeString()</a>, <a class="el" href="obix__client_8h-source.html#l00058">OBIX_SUCCESS</a>, and <a class="el" href="obix__client_8c-source.html#l00676">obix_writeValue()</a>.</p>

<p>Referenced by <a class="el" href="example__timer_8c-source.html#l00149">main()</a>.</p>

</div>
</div><p>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="d34745f2e7e68a9694ec9a12c648bd75"></a><!-- doxytag: member="example_timer.c::_time" ref="d34745f2e7e68a9694ec9a12c648bd75" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long <a class="el" href="example__timer_8c.html#d34745f2e7e68a9694ec9a12c648bd75">_time</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Elapsed time is stored here. 
<p>Definition at line <a class="el" href="example__timer_8c-source.html#l00030">30</a> of file <a class="el" href="example__timer_8c-source.html">example_timer.c</a>.</p>

<p>Referenced by <a class="el" href="example__timer_8c-source.html#l00083">generateTimeString()</a>, <a class="el" href="example__timer_8c-source.html#l00050">resetListener()</a>, and <a class="el" href="example__timer_8c-source.html#l00113">timerTask()</a>.</p>

</div>
</div><p>
<a class="anchor" name="a3666ba0befbc998cc4bc96d3d3ed96d"></a><!-- doxytag: member="example_timer.c::_time_mutex" ref="a3666ba0befbc998cc4bc96d3d3ed96d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_mutex_t <a class="el" href="example__timer_8c.html#a3666ba0befbc998cc4bc96d3d3ed96d">_time_mutex</a> = PTHREAD_MUTEX_INITIALIZER          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Need mutex for synchronization, because _time variable is accessed from two threads. 
<p>Definition at line <a class="el" href="example__timer_8c-source.html#l00037">37</a> of file <a class="el" href="example__timer_8c-source.html">example_timer.c</a>.</p>

<p>Referenced by <a class="el" href="example__timer_8c-source.html#l00050">resetListener()</a>, and <a class="el" href="example__timer_8c-source.html#l00113">timerTask()</a>.</p>

</div>
</div><p>
<a class="anchor" name="ef8634b59ae35cce508a6ce03b4d0564"></a><!-- doxytag: member="example_timer.c::_time_str" ref="ef8634b59ae35cce508a6ce03b4d0564" args="[32]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="example__timer_8c.html#ef8634b59ae35cce508a6ce03b4d0564">_time_str</a>[32]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Used for string representation of the timer value. 
<p>Definition at line <a class="el" href="example__timer_8c-source.html#l00032">32</a> of file <a class="el" href="example__timer_8c-source.html">example_timer.c</a>.</p>

<p>Referenced by <a class="el" href="example__timer_8c-source.html#l00083">generateTimeString()</a>, and <a class="el" href="example__timer_8c-source.html#l00113">timerTask()</a>.</p>

</div>
</div><p>
<a class="anchor" name="9c4545e53444d246701d1051c17cf6f8"></a><!-- doxytag: member="example_timer.c::DEVICE_DATA" ref="9c4545e53444d246701d1051c17cf6f8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="example__timer_8c.html#9c4545e53444d246701d1051c17cf6f8">DEVICE_DATA</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<b>Initial value:</b><div class="fragment"><pre class="fragment">
    <span class="stringliteral">"&lt;obj name=\"ExampleTimer\" displayName=\"Example Timer\" href=\"%s\"&gt;\r\n"</span>
    <span class="stringliteral">"  &lt;reltime name=\"time\" displayName=\"Elapsed Time\" href=\"%stime\" val=\"PT0S\" writable=\"true\"/&gt;\r\n"</span>
    <span class="stringliteral">"  &lt;bool name=\"reset\" displayName=\"Reset Timer\" href=\"%sreset\" val=\"false\" writable=\"true\"/&gt;\r\n"</span>
    <span class="stringliteral">"&lt;/obj&gt;"</span>
</pre></div>Data which is posted to oBIX server. 
<p>Definition at line <a class="el" href="example__timer_8c-source.html#l00023">23</a> of file <a class="el" href="example__timer_8c-source.html">example_timer.c</a>.</p>

</div>
</div><p>
<a class="anchor" name="8c0ec52cbb654e552557839aca0317a8"></a><!-- doxytag: member="example_timer.c::taskThread" ref="8c0ec52cbb654e552557839aca0317a8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Task_Thread* <a class="el" href="example__timer_8c.html#8c0ec52cbb654e552557839aca0317a8">taskThread</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Separate thread for timer value updating. 
<p>Definition at line <a class="el" href="example__timer_8c-source.html#l00039">39</a> of file <a class="el" href="example__timer_8c-source.html">example_timer.c</a>.</p>

<p>Referenced by <a class="el" href="example__timer_8c-source.html#l00149">main()</a>.</p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed May 20 15:56:12 2009 for libcot by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
